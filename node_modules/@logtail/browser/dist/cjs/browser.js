"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Browser = void 0;
const cross_fetch_1 = __importDefault(require("cross-fetch"));
const core_1 = require("@logtail/core");
// Awaiting: https://bugs.chromium.org/p/chromium/issues/detail?id=571722
// import { getUserAgent } from "./helpers";
class Browser extends core_1.Base {
    constructor(sourceToken, options) {
        super(sourceToken, options);
        // Sync function
        const sync = async (logs) => {
            const res = await cross_fetch_1.default(this._options.endpoint, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${this._sourceToken}`
                    // Awaiting: https://bugs.chromium.org/p/chromium/issues/detail?id=571722
                    // "User-Agent": getUserAgent()
                },
                body: JSON.stringify(logs)
            });
            if (res.ok) {
                return logs;
            }
            /**
             * TODO: if status is 50x throw custom ServerError
             * to be used in retry logic
             */
            throw new Error(res.statusText);
        };
        // Set the throttled sync function
        this.setSync(sync);
    }
}
exports.Browser = Browser;
//# sourceMappingURL=browser.js.map